generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum MetadataCategory {
  DEVICE
  CHRONOLOGY
  LOCATION
  EXPOSURE
  LENS
  ORIENTATION
  IMAGE_PROCESSING
  COLOR
  FILE
  MAKERNOTES
  MISC
}

enum Segment {
  TIFF
  XMP
  ICC
  IPTC
  JFIF
  IHDR
}

enum Units {
  NONE
  STRING
  BOOLEAN
  SECONDS
  FSTOP
  ISO
  KELVIN
  METERS
  DEGREES
  KILOMETERS_PER_HOUR
  METERS_PER_SECOND
  MILLIMETERS
  MM_EQUIV
  BYTES
  PIXELS
  PERCENT
  DATETIME
  APEX
  INCHES
  EV
  BUFFER
}

model Images {
  id          Int       @id @default(autoincrement())
  path        String
  sha256      Bytes     
  exif_tags   ExifTag[]
  upload_time DateTime  @default(now())
  updated_at  DateTime  @updatedAt

  @@index([upload_time])
}

model ExifTag {
  id          Int       @id @default(autoincrement())
  image       Images    @relation(fields: [image_id], references: [id])
  image_id    Int       
  category    MetadataCategory?
  segment     Segment
  tag         String
  tag_id      String?
  value       String?
  raw_value   String?
  raw_json    Json?
  units       Units

  @@index([image_id])
  @@index([category])
  @@index([segment])
  @@index([image_id, category])
}